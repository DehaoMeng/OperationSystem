# 操作系统实验三

虚拟存储器

## (1)题目

第一题：模拟分页式存储管理中硬件的地址转换和产生缺页中断。

第二题：用先进先出（FIFO）页面调度算法处理缺页中断。

## (2)提示

### 第一题

（1） 分页式虚拟存储系统是把作业信息的副本存放在磁盘上，当作业被选中时，可把作 业的开始几页先装入主存且启动执行。为此，在为作业建立页表时，应说明哪些页 已在主存，哪些页尚未装入主存，页表的格式为：

| 页号 | 标志 | 主存块号 | 在磁盘上的位置 |
| :--: | :--: | :------: | -------------- |
|      |      |          |                |

其中，标志----用来表示对应页是否已经装入主存，标志位=1，则表示该页已经在主存，标志位=0，则表示该页尚未装入主存。 

主存块号----用来表示已经装入主存的页所占的块号。

在磁盘上的位置----用来指出作业副本的每一页被存放在磁盘上的位置。

（2） 作业执行时，指令中的逻辑地址指出了参加运算的操作存放的页号和单元号，硬件 的地址转换机构按页号查页表，若该页对应标志为“1”，则表示该页已在主存，这 时根据关系式：
$$
绝对地址=块号×块长+单元号
$$
计算出欲访问的主存单元地址。如果块长为 2 的幂次，则可把块号作为高地址部分， 把单元号作为低地址部分，两者拼接而成绝对地址。若访问的页对应标志为“0”， 则表示该页不在主存，这时硬件发“缺页中断”信号，有操作系统按该页在磁盘上 的位置，把该页信息从磁盘读出装入主存后再重新执行这条指令。

（3） 设计一个“地址转换”程序来模拟硬件的地址转换工作。当访问的页在主存时，则 形成绝对地址，但不去模拟指令的执行，而用输出转换后的地址来代替一条指令的 执行。当访问的页不在主存时，则输出“* 该页页号”，表示产生了一次缺页中断。

![image-20220705184930868](E:\ujs_meng\Operating_System\OperationSystem\project\Test3\实验三.assets\image-20220705184930868.png)

（4） 假定主存的每块长度为 128 个字节；现有一个共七页的作业，其中第 0 页至第 3 页 已经装入主存，其余三页尚未装入主存；该作业的页表为：

![image-20220705185002962](E:\ujs_meng\Operating_System\OperationSystem\project\Test3\实验三.assets\image-20220705185002962.png)

如果作业依次执行的指令序列为：

![image-20220705185020921](E:\ujs_meng\Operating_System\OperationSystem\project\Test3\实验三.assets\image-20220705185020921.png)	（5) 运行设计的地址转换程序，显示或打印运行结果。因仅模拟地址转换，并不模拟指 令的执行，故可不考虑上述指令序列中的操作。

### 第二题

（1） 在分页式虚拟存储系统中，当硬件发出“缺页中断”后，引出操作系统来处理这个 中断事件。如果主存中已经没有空闲块，则可用 FIFO 页面调度算法把该作业中最 先进入主存的一页调出，存放到磁盘上，然后再把当前要访问的页装入该块。调出 和装入后都要修改页表页表中对应页的标志。 （2） FIFO 页面调度算法总是淘汰该作业中最先进入主存的那一页，因此可以用一个数组 来表示该作业已在主存的页面。假定作业被选中时，把开始的 m 个页面装入主存， 则数组的元素可定为 m 个。例如：
$$
P[0]，P[1]，….，P[m-1]
$$
其中每一个 P[i]（i=0，1，….，m-1）表示一个在主存中的页面号。它们的初值为：
$$
P[0]:=0，P[1]:=1，….，P[m-1]:=m-1
$$
用一指针 k 指示当要装入新页时，应淘汰的页在数组中的位置，k 的初值为“0”。 当产生缺页中断后，操作系统选择 P[k]所指出的页面调出，然后执行：

~~~
P[k]:=要装入页的页号
k:=(k+1) mod m
~~~

再由装入程序把要访问的一页信息装入到主存中。重新启动刚才那条指令执行。

（3） 编制一个 FIFO 页面调度程序，为了提高系统效率，如果应淘汰的页在执行中没有 修改过，则可不必把该页调出（因在磁盘上已有副本）而直接装入一个新页将其覆 盖。因此在页表中增加是否修改过的标志，为“1”表示修改过，为“0”表示未修 改过，格式为：

| 页号 | 标志 | 主存块号 | 修改标志 | 在磁盘上的位置 |
| :--: | :--: | :------: | -------- | -------------- |
|      |      |          |          |                |

由于是模拟调度算法，所以，不实际启动输出一页和装入一页的程序，而用输出调 出的页号和装入的页号来代替一次调出和装入的过程。 把第一题中程序稍作修改，与本题结合起来，

![image-20220705191705913](E:\ujs_meng\Operating_System\OperationSystem\project\Test3\实验三.assets\image-20220705191705913.png)

 磁盘上，在磁盘上的存放地址以及已装入主存的页和作业依次执行的指令序列都同 第一题中（4）所示。于是增加了“修改标志”后的初始页表为：

![image-20220705191742528](E:\ujs_meng\Operating_System\OperationSystem\project\Test3\实验三.assets\image-20220705191742528.png)

按依次执行的指令序列，运行你所设计的程序，显示或打印每次调出和装入的页号， 以及执行了最后一条指令后的数组 P 的值。

（5） 为了检查程序的正确性，可再任意确定一组指令序列，运行设计的程序，核对执行 的结果。

## (3)实现思路

未记录思路，大致流程完全根据提示一步一步完成。

## 源码

点击查看源码(如果打不开请多访问几次，国内访问github容易失败)

